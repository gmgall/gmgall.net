<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>Windows 95 no QEMU</title>
	<meta name="description" content="O site pessoal de Guilherme Magalh√£es Gall, um trabalhador da √°rea de TI. Cont√©m textos t√©cnicos sobre programa√ß√£o e os demais assuntos que interessam ao autor.">
	<meta name="author" content="Guilherme Magalh√£es Gall">
	<meta name="generator" content="Hugo 0.109.0">
	<meta name="keywords" content="retrocomputing, qemu, windows">
	<link rel="me" href="https://bolha.us/@gmgall">
	<link rel="me" href="https://ursal.zone/@gmgall">
	<meta name="fediverse:creator" content="@gmgall@ursal.zone" />
	<link rel="stylesheet" href="/css/style.css">
	<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë®‚Äçüíª</text></svg>">
	<link rel="stylesheet" href="/css/custom.css?rnd=1757317514">
	
</head>
<body>
	<header>
	================
	<div style="border-style: dotted; border-width: 2px; float: right">
	<label for="toggle-switch"><small>inverter tema</small></label>
	<input type="checkbox" id="toggle-switch">
	</div><br>
	== <a href="https://gmgall.net/">gmgall.net</a> ==<br>
	================
	<div style="float: right;">√â de compreender que sobretudo nos cansamos. Viver √© n√£o pensar.</div><br>
	<p>
	<nav>
			<a href="/"><b>In√≠cio</b></a>.
			
			
			<a href="/blog/"><b>Blog</b></a>.
			
			<a href="/categories/"><b>Categorias</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
			<a href="/books/"><b>Livros lidos</b></a>.
			
			<a href="/feeds/"><b>Feeds üì°</b></a>.
			
			<a href="/blogroll/"><b>Blogroll</b></a>.
			
			<a href="/contact/"><b><span class="highlighted-entry">Contato</span></b></a>.
			
	</nav>
	</p>
			
</header>

	
	<main>
		<article>
			<h1>Windows 95 no QEMU</h1>
			<b><time>21.08.2024 20:38</time></b>
				
					<a class="category-link" href="/categories/tech">tech</a>
				
				
					<a href="/tags/retrocomputing">retrocomputing</a>
				
					<a href="/tags/qemu">qemu</a>
				
					<a href="/tags/windows">windows</a>
				

			<div>
				


				<p>Quem acompanhou minha <a href="https://www.collinsdictionary.com/dictionary/english/down-memory-lane">viagem estrada da saudade abaixo</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> com a <a href="/blog/nao-olho-mais-para-as-estrelas/">Enciclop√©dia do Espa√ßo e do Universo</a> viu algumas capturas de tela de um programa Windows de 16 bits.</p>
<p>Ele n√£o funcionou no <a href="https://www.winehq.org/">Wine</a> ou no <a href="https://www.dosbox.com/">DOSBox</a>. Nenhum Windows moderno executa mais esses programas<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. Precisei partir para emular uma instala√ß√£o completa do Windows 95. Decidi fazer com o <a href="https://www.qemu.org/">QEMU</a>.</p>
<p>H√° <a href="https://wiki.qemu.org/Documentation/GuestOperatingSystems/Windows95">mais</a> de um <a href="https://computernewb.com/wiki/QEMU/Guests/Windows_95">guia</a> de como fazer essa instala√ß√£o na <em>web</em>, mas na minha experi√™ncia nenhum deles funcionou exatamente como descrito. Foi um processo que demandou uma boa quantidade de tentativa e erro. Testei muitas <em>flags</em> do comando <code>qemu-system-i386</code> e muitos <em>drivers</em> no sistema convidado diferentes.</p>
<p>N√£o vou nem fingir que isso √© um tutorial porque eu n√£o imaginava que seria necess√°rio futucar<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> tanto na instala√ß√£o quando comecei. N√£o anotei meus passos de forma muito organizada. Abaixo vou meramente listar algumas coisas que acho √∫teis ter em mente caso eu decida repetir uma instala√ß√£o dessas. Se for √∫til para mais algu√©m, excelente.</p>
<figure><img src="win95_version.png"
         alt="Janela &#34;Propriedades Sistema&#34; do Windows 95. Ela mostra a vers√£o do Windows, do IE, o Processador e a quantidade de mem√≥ria RAM instalada."/><figcaption>
            <h4>A vers√£o do Windows 95 que instalei.</h4>
        </figcaption>
</figure>

<h2 id="fat-16-ou-32">FAT 16 ou 32?</h2>
<p>Cuidado ao formatar a parti√ß√£o que vai receber o sistema. O Windows 95 n√£o suporta FAT 32 em todas as vers√µes lan√ßadas. A que eu instalei, 4.00.950, n√£o suporta.</p>
<h2 id="cpus-modernas-podem-operar-numa-frequ√™ncia-alta-demais-para-o-windows-95">CPUs modernas podem operar numa frequ√™ncia alta demais para o Windows 95</h2>
<p>Se o Windows travar em todo <em>boot</em> p√≥s-instala√ß√£o, pode ser que a frequ√™ncia de opera√ß√£o do seu processador seja elevada demais para ele. H√° um <a href="https://archive.org/details/fix-95-cpu-v3-final"><em>patch</em> para isso no Internet Archive</a>.</p>
<p>O erro se n√£o me engano √© <code>Windows Protection Error. You need to restart your computer.</code>. No meu caso acho que estava localizado, recebi um <code>Erro de Prote√ß√£o do Windows</code>.</p>
<h2 id="o-cd-do-windows-95-n√£o-√©-boot√°vel">O CD do Windows 95 n√£o √© <em>boot√°vel</em></h2>
<p>√â necess√°rio primeiro <em>bootar</em> via disquete no MS-DOS, <strong>depois</strong> executar <code>D:\SETUP.EXE</code> ou <code>D:\INSTALAR.EXE</code>, supondo que <code>D:</code> seja sua unidade de CD-ROM.</p>
<p>Uma imagem de disquete est√° dispon√≠vel <a href="https://winworldpc.com/product/microsoft-windows-boot-disk/95-osr2x">aqui</a>.</p>
<p>Um menu ser√° apresentado ao <em>bootar</em> com esse disquete. Tive sucesso em iniciar uma instala√ß√£o com a 1¬™ op√ß√£o.</p>
<figure><img src="win95_boot_floppy.png"
         alt="Janela do QEMU mostrando o menu apresentado pelo disquete de boot. H√° 5 op√ß√µes. As 4 primeiras carregam diferentes drivers de unidade CD-ROM. A √∫ltima √© &#34;No CDROM support&#34;. Consegui fazer funcionar usando a op√ß√£o 1."/><figcaption>
            <h4>Menu apresentado pelo disquete de boot.</h4>
        </figcaption>
</figure>

<h2 id="sound-blaster-16-produz-√°udio-picotado">Sound Blaster 16 produz √°udio &ldquo;picotado&rdquo;</h2>
<p>Ambas as wikis que referenciei acima recomendam usar a Sound Blaster 16 como placa de √°udio da m√°quina virtual. N√£o tive sucesso com ela. Ela instalou, mas o som sa√≠a como no v√≠deo abaixo.</p>
<video width="720" height="480" controls title="√Åudio falhando na m√°quina virtual com placa Sound Blaster 16." aria-label="V√≠deo com captura de tela de um desktop XFCE. Do lado esquerdo aparece um emulador de terminal com um comando que executa uma m√°quina virtual QEMU. Do lado direito, h√° a tela da m√°quina virtual em si. Dentro da m√°quina virtual, o cursor vai no menu Iniciar, depois em Documentos. Um arquivo de √°udio √© selecionado. O player abre e o som √© reproduzido, mas n√£o perfeitamente.">
<source src="qemu_win95_audio_fail.mp4" type="video/mp4"></source>
</video>
<p>A <strong>Realtek AC97</strong> produziu √°udio limpo, mas n√£o era detectada imediatamente. Leia o ponto abaixo.</p>
<h2 id="instalar-o-pci-bus-fez-muitos-dispositivos-serem-detectados-automaticamente">Instalar o <code>PCI bus</code> fez muitos dispositivos serem detectados automaticamente</h2>
<p>Essa foi uma dica que colocou muita coisa para funcionar. Infelizmente estava num <a href="https://youtu.be/dt67xEXoqRY">v√≠deo</a> e n√£o num texto, foi mais dif√≠cil de achar. Coisas da <a href="https://thewebisfucked.com/"><em>web</em> moderna</a>.</p>
<p>O trecho com o &ldquo;pulo do gato&rdquo; est√° abaixo:</p>
<video width="720" height="480" controls title="Instala√ß√£o do &#34;PCI bus&#34; numa m√°quina virtual com Windows 98." aria-label="Trecho de v√≠deo que ensina como instalar o driver do &#34;PCI bus&#34; numa m√°quina virtual com Windows 98. O processo funcionou igual no 95 para mim. H√° uma descri√ß√£o textual do que √© feito abaixo desse v√≠deo.">
<source src="pci_bus.mp4" type="video/mp4"></source>
</video>
<p>Textualmente: clique com o bot√£o direito em <code>Meu Computador</code>. Na janela que vai se abrir, clique na aba <code>Gerenciador de Dispositivos</code>. Em <code>Dispositivos do sistema</code>, o dispositivo <code>BIOS Plug and Play</code> estar√° marcado com uma exclama√ß√£o amarela. D√™ um duplo clique sobre ele e na aba <code>Driver</code> clique no bot√£o <code>Atualizar driver</code>. No assistente que vai abrir, selecione que deseja escolher o <em>driver</em> de uma lista. Marque que quer exibir todos os <em>drivers</em> e escolha o <em>driver</em> <code>PCI bus</code>. Siga com o assistente de instala√ß√£o de <em>drivers</em> at√© o final do processo. Aceite a reinicializa√ß√£o do computador. Ap√≥s reiniciar, v√°rios dispositivos ser√£o detectados automaticamente.</p>
<h2 id="verificar-o-endere√ßo-ip">Verificar o endere√ßo IP</h2>
<p>O programa que mostra o endere√ßo IP, a m√°scara de sub-rede e o <em>gateway</em> padr√£o no Windows 95 √© o <code>winipcfg</code>.</p>
<figure><img src="winipcfg.png"
         alt="Programa winipcfg do Windows 95. √â uma pequena janela com o endere√ßo MAC da placa de rede, o endere√ßo IP da interface, a m√°scara de sub-rede e o gateway padr√£o. Abaixo dessas informa√ß√µes h√° os bot√µes &#34;OK&#34;, &#34;Liberar&#34;, &#34;Renovar&#34;, &#34;Liberar tudo&#34;, &#34;Renovar tudo&#34; e &#34;Mais informa√ß√µes&#34;."/><figcaption>
            <h4>Programa winipcfg do Windows 95.</h4>
        </figcaption>
</figure>

<h2 id="solucionar-erro-ap√≥s-desinstala√ß√£o-de-cliente-novell-netware">Solucionar erro ap√≥s desinstala√ß√£o de cliente Novell NetWare</h2>
<p>Ap√≥s desinstalar o cliente Novell NetWare, √© poss√≠vel que voc√™ receba um erro como <code>The NetWare-compatible shell is not available</code> antes de cada login. A solu√ß√£o para isso est√° detalhada <a href="https://kb.iu.edu/d/acyl">aqui</a>.</p>
<h2 id="a-linha-de-comando-do-qemu">A linha de comando do QEMU</h2>
<p>Com a instala√ß√£o finalmente funcional, executo a m√°quina virtual com o seguinte comando:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>qemu-system-i386 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-netdev user,id<span style="color:#f92672">=</span>mynet0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-device pcnet,netdev<span style="color:#f92672">=</span>mynet0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-hda ~/win95.qcow2 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-m <span style="color:#ae81ff">128</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-cpu pentium <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-cdrom Win95PTBR_201902/Win95_PTBR.iso <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-boot c <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-device cirrus-vga <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-device ac97,id<span style="color:#f92672">=</span>snd1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>	-audio pipewire,id<span style="color:#f92672">=</span>snd1
</span></span></code></pre></div><p><code>win95.qcow2</code> √© um arquivo de imagem de disco criado com o comando <code>qemu-img</code>.</p>
<h2 id="drivers-√∫teis">Drivers √∫teis</h2>
<p>2 listas de <em>drivers</em> que funcionam bem com os dispositivos virtuais que o QEMU oferece ao Windows 95 convidado:</p>
<ul>
<li><a href="https://www.claunia.com/qemu/drivers/index.html">Drivers 1</a></li>
<li><a href="https://drive.google.com/file/d/1ERRWMfL6DTSbShBa0NS1xWTKJ-mNjnCf/">Drivers 2</a></li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Pe√ßo perd√£o por essa tortura do vern√°culo.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Creio que a vers√£o mais &ldquo;moderna&rdquo; capaz de executar programas de 16 bits √© o XP.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Quase usei um <em>tinkering</em> aqui, mas prometi que n√£o teria mais tortura nesse texto.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

			</div>
		</article>
	</main>

<h3>Coment√°rios</h3>


<noscript>ATIVE JAVASCRIPT PARA ATIVAR O LINK A SEGUIR: </noscript><a id="email-link">üìß Responda por e-mail</a>
<script>
const email = 'dHp0bnl5QHR6bnZ5LnBieg=='

function decipher(email){
	const cipher = 'nopqrstuvwxyzabcdefghijklm'
	const alpha = 'abcdefghijklmnopqrstuvwxyz'
	return email.replace(/[a-z]/gi, letter => alpha[cipher.indexOf(letter)])
}

const el = document.getElementById('email-link')
el.setAttribute('href', 'mailto:'+decipher(atob(email))+'?subject=Windows 95 no QEMU')
</script>



<details>
  <summary>Responda pelo fediverso</summary>
  <p>Responda pelo fediverso colando a URL abaixo no seu cliente: <pre>https://ursal.zone/@gmgall/113006286894702173</pre></p>
  <button onclick="navigator.clipboard.writeText('https:\/\/ursal.zone\/@gmgall\/113006286894702173')">COPIAR URL</button>
</details>
<a id="load-comments">Carregar coment√°rios</a>

<div id="comments-list"></div>


<script src="/js/purify.min.js"></script>
<script>
  document.getElementById('load-comments').addEventListener('click', async () => {
    document.getElementById('load-comments').remove()
    const response = await fetch('https:\/\/ursal.zone/api/v1/statuses/113006286894702173/context')
    const data = await response.json()

    if (data.descendants && data.descendants.length > 0) {
      let descendants = data.descendants
      for (let descendant of descendants) {
        document.getElementById('comments-list').appendChild(DOMPurify.sanitize(createCommentEl(descendant), { 'RETURN_DOM_FRAGMENT': true }))
      }
    } else {
      document.getElementById('comments-list').innerHTML = '<p>‚ö†Ô∏è Sem coment√°rios no fediverso. ‚ö†Ô∏è</p>'
    }
  })

  function createCommentEl(d) {
    let comment = document.createElement('div')
    comment.classList.add('comment')

    let commentHeader = document.createElement('div')
    commentHeader.classList.add('comment-header')

    let userAvatar = document.createElement('img')
    userAvatar.classList.add('avatar')
    userAvatar.setAttribute('height', 60 )
    userAvatar.setAttribute('width', 60 )
    userAvatar.setAttribute('src', d.account.avatar_static)

    let userLink = document.createElement('a')
    userLink.classList.add('user-link')
    userLink.setAttribute('href', d.account.url)
    for (let emoji of d.account.emojis) {
      d.account.display_name = d.account.display_name.replace(
        `:${emoji.shortcode}:`,
        `<img src="${emoji.static_url}" alt="${emoji.shortcode}" height="14px" width="14px" />`
        )
    }
    let serverName = d.account.url.replace(/https?:\/\/(.+)\/@.+/, '$1')
    userLink.innerHTML = d.account.display_name + " (@" + d.account.username + "@" + serverName + ")"

    let commentDateTime = document.createElement('a')
    commentDateTime.classList.add('comment-date')
    commentDateTime.setAttribute('href', d.url)
    commentDateTime.innerHTML = d.created_at.substr(0, 10).replace(/([0-9]{4})-([0-9]{2})-([0-9]{2})/, '$3/$2/$1')

    commentHeader.appendChild(userAvatar)
    commentHeader.appendChild(userLink)
    commentHeader.appendChild(commentDateTime)

    let commentContent = document.createElement('p')
    commentContent.innerHTML = d.content

    comment.appendChild(commentHeader)
    comment.appendChild(commentContent)

    return comment
  }
</script>


<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/books/tudo-e-eventual/">Tudo √© Eventual</a></li>
				
				<li><a href="/blog/privatizacao-terceirizacao-e-morte/">Privatiza√ß√£o, Terceiriza√ß√£o e Morte</a></li>
				
				<li><a href="/blog/os-protetores-de-criancinhas-atacam-de-novo/">Os Protetores de Criancinhas Atacam de Novo</a></li>
				
				<li><a href="/blog/workflows-do-github-actions-indefinidamente-como-queued/">Workflows do GitHub Actions Indefinidamente Como &#34;Queued&#34;</a></li>
				
				<li><a href="/blog/a-ficha-esta-caindo/">A Ficha Est√° Caindo (na Europa)</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p><a href="/license">CC</a> 2025 <a href="https://gmgall.net/"><b>gmgall.net</b></a>.
	</p>
</footer>

</body>
<script src="/js/theme.js"></script>
</html>
