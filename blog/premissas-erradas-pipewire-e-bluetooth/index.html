<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>Premissas Erradas, PipeWire e Bluetooth</title>
	<meta name="description" content="O site pessoal de Guilherme Magalh√£es Gall, um trabalhador da √°rea de TI. Cont√©m textos t√©cnicos sobre programa√ß√£o e os demais assuntos que interessam ao autor.">
	<meta name="author" content="Guilherme Magalh√£es Gall">
	<meta name="generator" content="Hugo 0.109.0">
	<meta name="keywords" content="linux, void, sysadmin">
	<link rel="me" href="https://bolha.us/@gmgall">
	<link rel="me" href="https://ursal.zone/@gmgall">
	<meta name="fediverse:creator" content="@gmgall@ursal.zone" />
	<link rel="stylesheet" href="/css/style.css">
	<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë®‚Äçüíª</text></svg>">
	<link rel="stylesheet" href="/css/custom.css?rnd=1754881462">
	
</head>
<body>
	<header>
	================
	<div style="border-style: dotted; border-width: 2px; float: right">
	<label for="toggle-switch"><small>inverter tema</small></label>
	<input type="checkbox" id="toggle-switch">
	</div><br>
	== <a href="https://gmgall.net/">gmgall.net</a> ==<br>
	================
	<div style="float: right;">√â de compreender que sobretudo nos cansamos. Viver √© n√£o pensar.</div><br>
	<p>
	<nav>
			<a href="/"><b>In√≠cio</b></a>.
			
			
			<a href="/blog/"><b>Blog</b></a>.
			
			<a href="/categories/"><b>Categorias</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
			<a href="/books/"><b>Livros lidos</b></a>.
			
			<a href="/feeds/"><b>Feeds üì°</b></a>.
			
			<a href="/blogroll/"><b>Blogroll</b></a>.
			
			<a href="/contact/"><b><span class="highlighted-entry">Contato</span></b></a>.
			
	</nav>
	</p>
			
</header>

	
	<main>
		<article>
			<h1>Premissas Erradas, PipeWire e Bluetooth</h1>
			<b><time>22.07.2024 16:29</time></b>
				
					<a class="category-link" href="/categories/tech">tech</a>
				
					<a class="category-link" href="/categories/non-tech">non-tech</a>
				
				
					<a href="/tags/linux">linux</a>
				
					<a href="/tags/void">void</a>
				
					<a href="/tags/sysadmin">sysadmin</a>
				

			<div>
				


				<p>Esse final de semana relembrei que pode ser elevado o custo de partir de premissas erradas e n√£o gastar nem 5 minutinhos verificando a validade delas. Marquei com <a href="/categories/tech/">tech</a> e <a href="/categories/non-tech/">non-tech</a> porque honestamente acho que isso √© uma li√ß√£o tanto na √°rea t√©cnica quanto para a vida.üòÖ</p>
<p>Ap√≥s um desastre na parti√ß√£o em que mantinha meu <a href="https://xubuntu.org/">SO principal</a>, resolvi aproveitar a oportunidade da reinstala√ß√£o para finalmente testar outra distro. Estava incomodado com os rumos de Ubuntu e derivados j√° h√° algum tempo, mas a pregui√ßa vencia a insatisfa√ß√£o e eu n√£o trocava.</p>
<p>Queria testar algo sem <a href="https://systemd.io/">systemd</a>, mais minimalista e em que eu me sentisse no controle do SO de novo. Uma distro em que eu entendesse melhor que estava acontecendo. Fiquei entre <a href="https://archlinux.org/">Arch</a>, <a href="https://www.gentoo.org/">Gentoo</a> e <a href="https://voidlinux.org/">Void</a>. Acabei escolhendo esse √∫ltimo e as primeiras impress√µes t√™m sido excelentes.</p>
<p>A <a href="https://docs.voidlinux.org/">documenta√ß√£o do Void Linux</a>, apesar de menor que a dispon√≠vel nas excelentes wikis de <a href="https://wiki.gentoo.org/wiki/Main_Page">Gentoo</a> e <a href="https://wiki.archlinux.org/title/Main_page">Arch</a>, tem tudo para voc√™ terminar com um desktop funcional. Ao menos foi minha experi√™ncia partindo da imagem do Void + XFCE.</p>
<p>S√≥ uma coisa n√£o consegui fazer funcionar ap√≥s a 1¬™ leitura do t√≥pico correspondente na documenta√ß√£o oficial: Bluetooth. Meus fones pareavam por 1 ou 2 segundos e desconectavam logo em seguida. Confirmei que meu adaptador e fones funcionavam sem problemas testando no <a href="https://minios.dev/pt/">MiniOS</a> (um sabor de Debian). Era s√≥ no Void que eu n√£o conseguia parear. √Åudio era reproduzido nos alto-falantes, ent√£o <em>n√£o podia</em> ser o <a href="https://en.wikipedia.org/wiki/Sound_server"><em>sound server</em></a>, <em>tinha</em> que ser Bluetooth.</p>
<p>A <a href="https://docs.voidlinux.org/config/bluetooth.html">documenta√ß√£o sobre o assunto</a> √© bem direta:</p>
<blockquote>
<p>To use an audio device such as a wireless speaker or headset, ALSA users need to install the bluez-alsa package. PulseAudio users do not need any additional software. PipeWire users need libspa-bluetooth.</p>
</blockquote>
<figure><img src="captura_de_tela_2024-07-22_00-22-59.png"
         alt="Menu &#39;Aplicativos&#39; do XFCE. No submenu &#39;Multim√≠dia&#39; h√° um aplicativo chamado &#39;Controle de volume do PulseAudio&#39;."/><figcaption>
            <h4>Esse mixer funciona. Eu obviamente estou usando PulseAudio, certo?</h4>
        </figcaption>
</figure>

<p>Se eu uso PulseAudio, n√£o deveria precisar de mais nada. <em>Tinha</em> que ser Bluetooth.</p>
<p>Parti ent√£o para tentar deixar as vers√µes dos softwares instalados no Void iguais √†s dos softwares instalados no MiniOS (que eu sabia que funcionava). Devia ser alguma regress√£o. Fiz <em>build</em> do meu pr√≥prio pacote do <a href="https://www.bluez.org/">BlueZ</a> para poder fazer <em>downgrade</em> da vers√£o 5.76 para a 5.66, instalei outras 2 ou 3 vers√µes de kernel e gastei um bom tempo em <em>issues</em> do GitHub, listas de discuss√£o, f√≥runs etc.</p>
<p>Mesmo resultado. Pareava por apenas uns instantes.ü§¶‚Äç‚ôÇÔ∏è</p>
<p>Desisti de executar o <code>bluetoothd</code><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> como servi√ßo. Rodei o execut√°vel diretamente num <em>shell</em> com as <em>flags</em> <a href="https://man.voidlinux.org/bluetoothd#n"><code>-n</code></a> e <a href="https://man.voidlinux.org/bluetoothd#d,"><code>-d</code></a> enquanto tentava parear para ver se eu recebia alguma &ldquo;luz&rdquo; melhor que as mensagens de erro do <a href="https://man.voidlinux.org/bluetoothctl"><code>bluetoothctl</code></a><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</p>
<p>Eis que em algum ponto durante os breves instantes de pareamento, aparece algo como a mensagem abaixo:</p>
<pre tabindex="0"><code>a2dp-sink profile connect failed for 60:F4:3A:70:E4:0B: Protocol not available
</code></pre><p><a href="https://en.wikipedia.org/wiki/List_of_Bluetooth_profiles#Advanced_Audio_Distribution_Profile_%28A2DP%29">A2DP</a> tem a ver com √°udio&hellip; E se aconteceu o seguinte?</p>
<ol>
<li>O dispositivo pareava.</li>
<li>Ele tentava se registrar como um dispositivo capaz de A2DP de alguma forma.</li>
<li>O <em>sound server</em> n√£o suportava esse perfil.</li>
<li>O dispositivo se desconectava porque n√£o tinha mais o que ser feito.</li>
</ol>
<p>Foi minha hip√≥tese naquele momento, mas isso implicaria em erro na documenta√ß√£o do Void, que dizia claramente <em>PulseAudio users do not need any additional software.</em></p>
<p>Mas e se&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ pgrep -a pipewire
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1188</span> pipewire
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1233</span> /usr/bin/pipewire -c pipewire-pulse.conf
</span></span></code></pre></div><p>Eu estava, afinal, com o <a href="https://pipewire.org/">PipeWire</a> instalado e rodando.ü§°</p>
<p>Matei o processo, o som parou. Era o PipeWire em uso mesmo.ü§°ü§°</p>
<p>Voltei √† documenta√ß√£o, √†quele √∫nico par√°grafo. <em>PipeWire users need <code>libspa-bluetooth</code></em>. Instalei o pacote. Passou a parear e a reproduzir √°udio nos fones t√£o logo reiniciei os servi√ßos.ü§°ü§°ü§°</p>
<p>Por n√£o ter conferido o que eu estava <strong>realmente</strong><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> usando para √°udio, &ldquo;botei a culpa&rdquo; no subsistema errado e enveredei por um caminho que me tomou v√°rias horas. Verificar levaria s√≥ alguns segundos.</p>
<p>Acho que a moral da hist√≥ria √©: especialmente se for r√°pido e barato, cheque suas premissas.</p>
<blockquote>
<p>√â preciso ter d√∫vidas. S√≥ os est√∫pidos t√™m uma confian√ßa absoluta em si mesmos.</p>
<p>&ndash; Orson Welles</p>
</blockquote>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>O <em>daemon</em>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Uma ferramenta de CLI de controle de Bluetooth.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>A bem da verdade, o nome do <em>mixer</em> do XFCE ser &ldquo;Controle de volume <strong>do PulseAudio</strong>&rdquo;, me induziu bastante ao erro. N√£o muda o fato que conferir levaria literalmente apenas alguns segundos.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

			</div>
		</article>
	</main>

<h3>Coment√°rios</h3>


<noscript>ATIVE JAVASCRIPT PARA ATIVAR O LINK A SEGUIR: </noscript><a id="email-link">üìß Responda por e-mail</a>
<script>
const email = 'dHp0bnl5QHR6bnZ5LnBieg=='

function decipher(email){
	const cipher = 'nopqrstuvwxyzabcdefghijklm'
	const alpha = 'abcdefghijklmnopqrstuvwxyz'
	return email.replace(/[a-z]/gi, letter => alpha[cipher.indexOf(letter)])
}

const el = document.getElementById('email-link')
el.setAttribute('href', 'mailto:'+decipher(atob(email))+'?subject=Premissas Erradas, PipeWire e Bluetooth')
</script>



<details>
  <summary>Responda pelo fediverso</summary>
  <p>Responda pelo fediverso colando a URL abaixo no seu cliente: <pre>https://ursal.zone/@gmgall/112831806351052891</pre></p>
  <button onclick="navigator.clipboard.writeText('https:\/\/ursal.zone\/@gmgall\/112831806351052891')">COPIAR URL</button>
</details>
<a id="load-comments">Carregar coment√°rios</a>

<div id="comments-list"></div>


<script src="/js/purify.min.js"></script>
<script>
  document.getElementById('load-comments').addEventListener('click', async () => {
    document.getElementById('load-comments').remove()
    const response = await fetch('https:\/\/ursal.zone/api/v1/statuses/112831806351052891/context')
    const data = await response.json()

    if (data.descendants && data.descendants.length > 0) {
      let descendants = data.descendants
      for (let descendant of descendants) {
        document.getElementById('comments-list').appendChild(DOMPurify.sanitize(createCommentEl(descendant), { 'RETURN_DOM_FRAGMENT': true }))
      }
    } else {
      document.getElementById('comments-list').innerHTML = '<p>‚ö†Ô∏è Sem coment√°rios no fediverso. ‚ö†Ô∏è</p>'
    }
  })

  function createCommentEl(d) {
    let comment = document.createElement('div')
    comment.classList.add('comment')

    let commentHeader = document.createElement('div')
    commentHeader.classList.add('comment-header')

    let userAvatar = document.createElement('img')
    userAvatar.classList.add('avatar')
    userAvatar.setAttribute('height', 60 )
    userAvatar.setAttribute('width', 60 )
    userAvatar.setAttribute('src', d.account.avatar_static)

    let userLink = document.createElement('a')
    userLink.classList.add('user-link')
    userLink.setAttribute('href', d.account.url)
    for (let emoji of d.account.emojis) {
      d.account.display_name = d.account.display_name.replace(
        `:${emoji.shortcode}:`,
        `<img src="${emoji.static_url}" alt="${emoji.shortcode}" height="14px" width="14px" />`
        )
    }
    let serverName = d.account.url.replace(/https?:\/\/(.+)\/@.+/, '$1')
    userLink.innerHTML = d.account.display_name + " (@" + d.account.username + "@" + serverName + ")"

    let commentDateTime = document.createElement('a')
    commentDateTime.classList.add('comment-date')
    commentDateTime.setAttribute('href', d.url)
    commentDateTime.innerHTML = d.created_at.substr(0, 10).replace(/([0-9]{4})-([0-9]{2})-([0-9]{2})/, '$3/$2/$1')

    commentHeader.appendChild(userAvatar)
    commentHeader.appendChild(userLink)
    commentHeader.appendChild(commentDateTime)

    let commentContent = document.createElement('p')
    commentContent.innerHTML = d.content

    comment.appendChild(commentHeader)
    comment.appendChild(commentContent)

    return comment
  }
</script>


<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/blog/os-protetores-de-criancinhas-atacam-de-novo/">Os Protetores de Criancinhas Atacam de Novo</a></li>
				
				<li><a href="/blog/workflows-do-github-actions-indefinidamente-como-queued/">Workflows do GitHub Actions Indefinidamente Como &#34;Queued&#34;</a></li>
				
				<li><a href="/blog/a-ficha-esta-caindo/">A Ficha Est√° Caindo (na Europa)</a></li>
				
				<li><a href="/books/realismo-capitalista/">Realismo Capitalista</a></li>
				
				<li><a href="/blog/papagaios-estocasticos-e-o-futebol/">Papagaios Estoc√°sticos e o Futebol</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p><a href="/license">CC</a> 2025 <a href="https://gmgall.net/"><b>gmgall.net</b></a>.
	</p>
</footer>

</body>
<script src="/js/theme.js"></script>
</html>
