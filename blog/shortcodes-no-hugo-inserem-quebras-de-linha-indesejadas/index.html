<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>Shortcodes no Hugo Inserem Quebras de Linha Indesejadas</title>
	<meta name="description" content="O site pessoal de Guilherme Magalh√£es Gall, um trabalhador da √°rea de TI. Cont√©m textos t√©cnicos sobre programa√ß√£o e os demais assuntos que interessam ao autor.">
	<meta name="author" content="Guilherme Magalh√£es Gall">
	<meta name="generator" content="Hugo 0.109.0">
	<meta name="keywords" content="hugo, html">
	<link rel="me" href="https://bolha.us/@gmgall">
	<link rel="me" href="https://ursal.zone/@gmgall">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css?rnd=1695977019">
	
</head>
<body>
	<header>
	================
	<div style="border-style: dotted; border-width: 2px; float: right">
	<label for="toggle-switch"><small>inverter tema</small></label>
	<input type="checkbox" id="toggle-switch">
	</div><br>
	== <a href="https://gmgall.net/">gmgall.net</a> ==<br>
	================
	<div style="float: right;">√â de compreender que sobretudo nos cansamos. Viver √© n√£o pensar.</div><br>
	<p>
	<nav>
			<a href="/"><b>In√≠cio</b></a>.
			
			
			<a href="/blog/"><b>Blog</b></a>.
			
			<a href="/categories/"><b>Categorias</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
			<a href="/books/"><b>Livros lidos</b></a>.
			
			<a href="/feeds/"><b>Feeds üì°</b></a>.
			
			<a href="/contact/"><b><span class="highlighted-entry">Contato</span></b></a>.
			
	</nav>
	</p>
			
</header>

	
	<main>
		<article>
			<h1>Shortcodes no Hugo Inserem Quebras de Linha Indesejadas</h1>
			<b><time>08.02.2023 11:57</time></b>
				
					<a class="category-link" href="/categories/tech">tech</a>
				
				
					<a href="/tags/hugo">hugo</a>
				
					<a href="/tags/html">html</a>
				

			<div>
				


				<p>Essa j√° &ldquo;me pegou&rdquo; algumas vezes e demorei um pouco para encontrar solu√ß√£o, ent√£o documento aqui.</p>
<p>O <a href="https://gohugo.io/">Hugo</a> insere quebras de linha ap√≥s o conte√∫do gerado pelos <a href="https://gohugo.io/content-management/shortcodes/">shortcodes</a> que podem causar a renderiza√ß√£o do HTML de forma indesejada.</p>
<p>Exemplo: suponha que no seu site voc√™ queira tratar das palavras sagradas protegidas pelos <a href="https://youtu.be/0e2kaQqxmQ0">Cavaleiros que Dizem Ni</a>. Voc√™ quer usar um <em>snippet</em> de c√≥digo para inseri-las, afinal s√£o sagradas e voc√™ n√£o quer correr o risco de digit√°-las errado.</p>
<p>Ent√£o cria o seguinte <em>shortcode</em> em <code>layouts/shortcodes/sacred_words.html</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>{{ <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">words</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">slice</span> <span style="color:#e6db74">&#34;ni&#34;</span> <span style="color:#e6db74">&#34;peng&#34;</span> <span style="color:#e6db74">&#34;neee-won&#34;</span> }}
</span></span><span style="display:flex;"><span>{{ <span style="color:#a6e22e">upper</span> (<span style="color:#a6e22e">delimit</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">words</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#e6db74">&#34; e &#34;</span> ) }}
</span></span></code></pre></div><p>E usa o <em>shortcode</em> no meio do markdown em alguma p√°gina de conte√∫do. Exemplo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>Os Cavaleiros que Dizem &#34;Ni&#34; s√£o os quardi√µes das palavras sagradas {{&lt; <span style="color:#f92672">sacred_words</span> &gt;}}.
</span></span></code></pre></div><p>Ao visualizar o HTML gerado para esse trecho, v√™ algo como:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">p</span>&gt;Os Cavaleiros que Dizem &amp;ldquo;Ni&amp;rdquo; s√£o os quardi√µes das palavras sagradas 
</span></span><span style="display:flex;"><span>NI, PENG E NEEE-WON
</span></span><span style="display:flex;"><span>.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span></code></pre></div><p><strong>Tem uma quebra de linha indesejada no final do conte√∫do gerado pelo <em>shortcode</em>.</strong> O c√≥digo do <em>shortcode</em> n√£o insere essa quebra, mas ela est√° l√°. Isso faz esse trecho ser renderizado da seguinte forma pelos navegadores:</p>
<pre tabindex="0"><code>Os Cavaleiros que Dizem ‚ÄúNi‚Äù s√£o os quardi√µes das palavras sagradas NI, PENG E NEEE-WON .
</code></pre><p><strong>Tem um espa√ßo entre a √∫ltima palavra e o ponto final da frase</strong>.</p>
<p>Encontrei <strike>as gambiarras</strike>
 os <em>workarounds</em> para resolver esse problema numa <a href="https://github.com/gohugoio/hugo/issues/1753">issue do pr√≥prio projeto Hugo</a>, mas parece que a discuss√£o sobre mudar esse comportamento dos <em>shortcodes</em> n√£o andou muito. Resta-nos nos adaptar.</p>
<p><strike>Uma das gambiarras</strike>
Um dos recursos t√©cnicos √© truncar o arquivo do <em>shortcode</em> com o comando <code>truncate -s -1 layouts/shortcodes/sacred_words.html</code></p>
<p>Depois disso, o HTML gerado para o trecho que usa o <em>shortcode</em> fica assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">p</span>&gt;Os Cavaleiros que Dizem &amp;ldquo;Ni&amp;rdquo; s√£o os quardi√µes das palavras sagradas 
</span></span><span style="display:flex;"><span>NI, PENG E NEEE-WON.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span></code></pre></div><p>E √© renderizado da seguinte forma:</p>
<pre tabindex="0"><code>Os Cavaleiros que Dizem ‚ÄúNi‚Äù s√£o os quardi√µes das palavras sagradas NI, PENG E NEEE-WON.
</code></pre><p>Vit√≥ria!</p>
<p>Satisfeito, voc√™ decide que s√≥ falta uma coisa para o seu <em>shortcode</em> ficar perfeito: ele precisa inserir c√≥digo para gerar um alerta gritando &ldquo;ni&rdquo; a cada vez que a p√°gina √© (re)carregada. Por sorte, pouco c√≥digo precisa ser adicionado para isso. O <em>shortcode</em> agora tem a seguinte implementa√ß√£o:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>{{ <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">words</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">slice</span> <span style="color:#e6db74">&#34;ni&#34;</span> <span style="color:#e6db74">&#34;peng&#34;</span> <span style="color:#e6db74">&#34;neee-won&#34;</span> }}
</span></span><span style="display:flex;"><span>{{ <span style="color:#a6e22e">upper</span> (<span style="color:#a6e22e">delimit</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">words</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#e6db74">&#34; e &#34;</span> ) }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#a6e22e">script</span>&gt;<span style="color:#a6e22e">alert</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">NI</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)&lt;<span style="color:#f92672">/</span><span style="color:#a6e22e">script</span>&gt;
</span></span></code></pre></div><p>Dessa vez voc√™ est√° esperto e <strong>lembra de truncar o arquivo</strong>. Quando vai ver a p√°gina gerada num navegador, o alerta aparece, mas&hellip;</p>
<p>O espa√ßo entre a √∫ltima palavra sagrada e o ponto final est√° l√° de novo! Mesmo ap√≥s usar o <code>truncate</code>! O HTML foi gerado com uma quebra de linha indesejada novamente:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">p</span>&gt;Os Cavaleiros que Dizem &amp;ldquo;Ni&amp;rdquo; s√£o os quardi√µes das palavras sagradas 
</span></span><span style="display:flex;"><span>NI, PENG E NEEE-WON
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;<span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;NI&#39;</span>)&lt;/<span style="color:#f92672">script</span>&gt;.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span></code></pre></div><p>Se o seu <em>shortcode</em> vai inserir mais coisa do que a sa√≠da gerada pelos comandos da linguagem de <em>template</em> do Go, como √© o trecho <code>&lt;script&gt;alert('NI')&lt;/script&gt;.&lt;/p&gt;</code> no exemplo acima, voc√™ precisa retirar aquela quebra antes do trecho tamb√©m.</p>
<p>Isso pode ser feito deixando o <em>shortcode</em> assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>{{ <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">words</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">slice</span> <span style="color:#e6db74">&#34;ni&#34;</span> <span style="color:#e6db74">&#34;peng&#34;</span> <span style="color:#e6db74">&#34;neee-won&#34;</span> }}
</span></span><span style="display:flex;"><span>{{ <span style="color:#a6e22e">upper</span> (<span style="color:#a6e22e">delimit</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#a6e22e">words</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#e6db74">&#34; e &#34;</span> ) }}{{<span style="color:#f92672">-</span> <span style="color:#a6e22e">print</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">-</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#a6e22e">script</span>&gt;<span style="color:#a6e22e">alert</span>(<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">NI</span><span style="color:#960050;background-color:#1e0010">&#39;</span>)&lt;<span style="color:#f92672">/</span><span style="color:#a6e22e">script</span>&gt;
</span></span></code></pre></div><p>Agora sim, as quebras de linha que fazem a p√°gina ser renderizada erradamente est√£o fora. O espa√ßo antes do ponto final n√£o aparece mais e o alerta ocorre.</p>
<hr>
<p>A vers√£o dos softwares envolvidos no momento em que escrevo esse texto s√£o as seguintes:</p>
<pre tabindex="0"><code>$ go version
go version go1.19.4 linux/amd64
$ hugo version
hugo v0.109.0+extended linux/amd64 BuildDate=unknown
</code></pre>
			</div>
		</article>
	</main>


<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/blog/migrando-para-uma-alternativa-gpl-ao-lastpass-authenticator/">Migrando Para Uma Alternativa GPL Ao LastPass Authenticator</a></li>
				
				<li><a href="/blog/github-pages-underline/">GitHub Pages e Nomes de Diret√≥rio Iniciados com Underline</a></li>
				
				<li><a href="/blog/unsubscribe/">Quais Empresas Respeitam o &#34;Unsubscribe&#34;?</a></li>
				
				<li><a href="/blog/input_filename-em-jq-e-yq/">input_filename das ferramentas jq e yq n√£o funcionam como esperado</a></li>
				
				<li><a href="/blog/comentarios-via-mastodon/">Adicionando Coment√°rios via Mastodon em Sites Est√°ticos</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p><a href="/license">CC</a> 2023 <a href="https://gmgall.net/"><b>gmgall.net</b></a>.
	</p>
</footer>

</body>
<script src="/js/theme.js"></script>
</html>
