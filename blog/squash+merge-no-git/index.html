<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>squash&#43;merge no Git</title>
	<meta name="description" content="O site pessoal de Guilherme Magalh√£es Gall, um trabalhador da √°rea de TI. Cont√©m textos t√©cnicos sobre programa√ß√£o e os demais assuntos que interessam ao autor.">
	<meta name="author" content="Guilherme Magalh√£es Gall">
	<meta name="generator" content="Hugo 0.109.0">
	<meta name="keywords" content="git, scm">
	<link rel="me" href="https://bolha.us/@gmgall">
	<link rel="me" href="https://ursal.zone/@gmgall">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë®‚Äçüíª</text></svg>">
	<link rel="stylesheet" href="/css/custom.css?rnd=1705623158">
	
</head>
<body>
	<header>
	================
	<div style="border-style: dotted; border-width: 2px; float: right">
	<label for="toggle-switch"><small>inverter tema</small></label>
	<input type="checkbox" id="toggle-switch">
	</div><br>
	== <a href="https://gmgall.net/">gmgall.net</a> ==<br>
	================
	<div style="float: right;">√â de compreender que sobretudo nos cansamos. Viver √© n√£o pensar.</div><br>
	<p>
	<nav>
			<a href="/"><b>In√≠cio</b></a>.
			
			
			<a href="/blog/"><b>Blog</b></a>.
			
			<a href="/categories/"><b>Categorias</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
			<a href="/books/"><b>Livros lidos</b></a>.
			
			<a href="/feeds/"><b>Feeds üì°</b></a>.
			
			<a href="/contact/"><b><span class="highlighted-entry">Contato</span></b></a>.
			
	</nav>
	</p>
			
</header>

	
	<main>
		<article>
			<h1>squash&#43;merge no Git</h1>
			<b><time>01.05.2023 23:22</time></b>
				
					<a class="category-link" href="/categories/tech">tech</a>
				
				
					<a href="/tags/git">git</a>
				
					<a href="/tags/scm">scm</a>
				

			<div>
				


				<p>√Äs vezes, depois de terminar o trabalho num <em>feature branch</em> qualquer, voc√™ n√£o deseja simplesmente fazer um <code>merge</code>. Voc√™ quer dar uma &ldquo;limpada&rdquo; no hist√≥rico primeiro antes de fazer <code>merge</code>.</p>
<p>Frequentemente essa &ldquo;limpeza&rdquo; se d√° na forma de um <code>squash</code>, uma jun√ß√£o das altera√ß√µes inseridas por mais de um <em>commit</em>.</p>
<p>Por exemplo: o <a href="https://github.com/gmgall/gmgall.net">reposit√≥rio desse site</a> tem um <em>branch</em> <code>main</code> com hist√≥rico relativamente &ldquo;limpo&rdquo;. Cada <em>commit</em> representa um novo conte√∫do no site ou uma nova funcionalidade. O <a href="https://github.com/gmgall/gmgall.net/blob/main/.github/workflows/gh-pages-deployment.yml">workflow que faz deploy</a> do site √© disparado cada vez que eu fa√ßo um <code>push</code> em <code>main</code>.</p>
<p>Eu criei um <em>branch</em> local chamado <code>fediverse_comments</code> para trabalhar na funcionalidade de coment√°rios. Era uma funcionalidade nova, eu n√£o sabia exatamente quantos <em>commits</em> eu precisaria fazer. Estava experimentando muita coisa. Ent√£o, mesmo sendo local, n√£o quis fazer bagun√ßa em <code>main</code>.</p>
<figure><img src="branches_antes.png"
         alt="Screenshot do gitk mostrando um branch main e um branch fediverse_comments com v√°rios commits desorganizados."/><figcaption>
            <h4>Branch main &#34;limpo&#34; e feature branch fediverse_comments &#34;sujo&#34; antes do merge.</h4>
        </figcaption>
</figure>

<p>Depois de 5 <em>commits</em> em <code>fediverse_comments</code> (na imagem acima s√≥ aparecem 4, mas fiz mais um depois de tirar o <em>screenshot</em>) me dei por satisfeito. Era hora do <code>merge</code>.</p>
<p>Eu normalmente faria:</p>
<ul>
<li>
<p><code>git rebase -i</code> para transformar os <em>commits</em> em <code>fediverse_comments</code> em um ou mais <em>commits</em> &ldquo;limpos&rdquo;, ou seja, <em>commits</em> que eu estaria OK em trazer via <code>merge</code> para <code>main</code></p>
</li>
<li>
<p>trocaria para o <em>branch</em> <code>main</code></p>
</li>
<li>
<p>faria o <code>merge</code> com o <code>fediverse_comments</code> (agora j√° &ldquo;limpo&rdquo;)</p>
</li>
</ul>
<p>Eu achava um pouco &ldquo;indireto&rdquo; demais &ldquo;limpar&rdquo; um <em>branch</em> que em breve estaria em desuso para s√≥ depois fazer <code>merge</code>, mas era como eu sabia fazer e nunca me questionei muito.</p>
<p>Pois bem, descobri uma forma que me pareceu mais intuitiva semana passada. O comando <code>merge</code> j√° possui uma <em>flag</em> <code>--squash</code> que faz o que eu precisava.</p>
<p>Ent√£o, depois de terminar os trabalhos em <code>fediverse_comments</code>, foi s√≥ trocar para <code>main</code> e dar o seguinte comando:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git merge --squash fediverse_comments
</span></span></code></pre></div><p>O que esse comando faz √© colocar no <strong>working directory</strong> e na <strong>staging area</strong> todas as altera√ß√µes em <code>fediverse_comments</code>. Por√©m, <strong>n√£o faz <code>commit</code></strong>. Acho isso positivo porque me d√° a oportunidade de dar uma √∫ltima revisada ou de fazer mais alguma altera√ß√£o no <em>commit</em>.</p>
<p>N√£o precisei nessa situa√ß√£o, ent√£o fiz um <em>commit</em> de mensagem <code>Adiciona coment√°rios pelo fediverso</code> em <code>main</code>.</p>
<figure><img src="branches_depois.png"
         alt="Screenshot do gitk mostrando um branch main com um √∫nico commit limpo que traz as altera√ß√µes de todos os commits sujos de fediverse_comments."/><figcaption>
            <h4>Branch main &#34;limpo&#34; com um √∫nico commit com todas alterna√ß√µes feitas em fediverse_comments.</h4>
        </figcaption>
</figure>

<p>Dessa forma, meu <code>main</code> ficou apenas com <em>commits</em> &ldquo;limpos&rdquo; e poupei a etapa de fazer <code>squash</code> no <em>feature branch</em>. Devo fazer mais dessa forma no futuro.</p>

			</div>
		</article>
	</main>

<h3>Coment√°rios</h3>
<details>
  <summary>Responda pelo fediverso</summary>
  <p>Responda pelo fediverso colando a URL abaixo no seu cliente: <pre>https://bolha.us/@gmgall/110297045845070605</pre></p>
  <button onclick="navigator.clipboard.writeText('https:\/\/bolha.us\/@gmgall\/110297045845070605')">COPIAR URL</button>
</details>
<a id="load-comments">Carregar coment√°rios</a>

<div id="comments-list"></div>


<script src="/js/purify.min.js"></script>
<script>
  document.getElementById('load-comments').addEventListener('click', async () => {
    document.getElementById('load-comments').remove()
    const response = await fetch('https:\/\/bolha.us/api/v1/statuses/110297045845070605/context')
    const data = await response.json()

    if (data.descendants && data.descendants.length > 0) {
      let descendants = data.descendants
      for (let descendant of descendants) {
        document.getElementById('comments-list').appendChild(DOMPurify.sanitize(createCommentEl(descendant), { 'RETURN_DOM_FRAGMENT': true }))
      }
    } else {
      document.getElementById('comments-list').innerHTML = '<p>‚ö†Ô∏è Sem coment√°rios no fediverso. ‚ö†Ô∏è</p>'
    }
  })

  function createCommentEl(d) {
    let comment = document.createElement('div')
    comment.classList.add('comment')

    let commentHeader = document.createElement('div')
    commentHeader.classList.add('comment-header')

    let userAvatar = document.createElement('img')
    userAvatar.classList.add('avatar')
    userAvatar.setAttribute('height', 60 )
    userAvatar.setAttribute('width', 60 )
    userAvatar.setAttribute('src', d.account.avatar_static)

    let userLink = document.createElement('a')
    userLink.classList.add('user-link')
    userLink.setAttribute('href', d.account.url)
    for (let emoji of d.account.emojis) {
      d.account.display_name = d.account.display_name.replace(
        `:${emoji.shortcode}:`,
        `<img src="${emoji.static_url}" alt="${emoji.shortcode}" height="14px" width="14px" />`
        )
    }
    let serverName = d.account.url.replace(/https?:\/\/(.+)\/@.+/, '$1')
    userLink.innerHTML = d.account.display_name + " (@" + d.account.username + "@" + serverName + ")"

    let commentDateTime = document.createElement('a')
    commentDateTime.classList.add('comment-date')
    commentDateTime.setAttribute('href', d.url)
    commentDateTime.innerHTML = d.created_at.substr(0, 10).replace(/([0-9]{4})-([0-9]{2})-([0-9]{2})/, '$3/$2/$1')

    commentHeader.appendChild(userAvatar)
    commentHeader.appendChild(userLink)
    commentHeader.appendChild(commentDateTime)

    let commentContent = document.createElement('p')
    commentContent.innerHTML = d.content

    comment.appendChild(commentHeader)
    comment.appendChild(commentContent)

    return comment
  }
</script>


<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/blog/publicar-na-web-precisa-ficar-mais-facil/">Publicar na Web Precisa Ficar Mais F√°cil</a></li>
				
				<li><a href="/blog/activitypub-meta-e-espantalhos/">ActivityPub, Meta e Espantalhos</a></li>
				
				<li><a href="/blog/resolucao-para-2024/">Uma Resolu√ß√£o Para Esse Site em 2024</a></li>
				
				<li><a href="/books/sandman-estacao-das-brumas/">Sandman - Esta√ß√£o das Brumas</a></li>
				
				<li><a href="/books/a-billion-wicked-thoughts/">A Billion Wicked Thoughts: What the World&#39;s Largest Experiment Reveals About Human Desire</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p><a href="/license">CC</a> 2024 <a href="https://gmgall.net/"><b>gmgall.net</b></a>.
	</p>
</footer>

</body>
<script src="/js/theme.js"></script>
</html>
